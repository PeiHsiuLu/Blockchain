# Blockchain
台大薛智文教授：區塊鍊導論課程學習筆記

# Blockchain:Ourchain
[build OurChain line by lineLinks to an external site.](https://hackmd.io/Bo8C0LogQfmq_eSuOExr0w)  
# 期末專題

# 參考書籍
[1.Mastering Bitcoin 2nd Edition - 繁中](https://github.com/cypherpunks-core/bitcoinbook_2nd_zh)  
[2.Mastering Ethereum - 繁中](https://github.com/ChenPoWei/ethereumbook_zh/)  
[3.區塊鏈原理設計與應用](https://poweichen.gitbook.io/blockchain-guide-zh)  

# 上課筆記&學習紀錄
[1.9/16筆記](#916筆記)  
[2.9/23筆記](#923筆記)  
[3.9/30筆記](#930筆記)

-----
## 9/16筆記

### 1. 區塊鏈結構
區塊ID鏈接：每個區塊包含上一個區塊的ID（通常是哈希值），這種鏈接形成了區塊鏈，確保了順序和完整性。
### 2. 算力與挖礦
* 算力（Hash Rate）：衡量礦工解決PoW問題的計算能力，算力越高，挖出新區塊的速度越快。
* 礦池（Mining Pool）：多位礦工合力集中算力，以加快找到新區塊的機會。
### 3. 工作量證明（PoW）
* 工作量證明（PoW）：要求礦工進行大量計算以找到符合條件的哈希值。算力越高，找到哈希值的速度越快。
* 哈希值目標：共識算法設定哈希目標，礦工需找到比目標小的哈希值。
### 4. 礦工的角色與哈希值
* 礦工角色：礦工運算以尋找符合目標的哈希值，成功後才能打包交易並生成新區塊。
### 5. 區塊鏈共識算法與貝斯定理
* 貝斯定理：應用於區塊鏈共識算法，幫助節點達成一致。
### 6. 區塊鏈應用問題
* 區塊鏈儲存與利息問題：區塊鏈上挖到礦後如何儲存與分配資金，以及貨幣過量的風險問題。
### 7. 區塊鏈應用
* 智能合約：當交易變得複雜時，這些交易便成為智能合約。
* ID與身分驗證：在區塊鏈應用中，ID與第三方驗證至關重要。
### 8. 比特幣挖礦競賽
* PoW機制：確保交易安全和去中心化。礦工競爭解決複雜數學問題以挖出區塊，並獲得比特幣獎勵。
* 競賽目的：保障交易的安全性、新比特幣發行及系統去中心化。
### 9. 比特幣交易過程
* 交易輸入與輸出：比特幣交易涉及輸入與輸出，輸出腳本限制了誰可以提取比特幣。
* 找零機制：輸入需完全消耗，找零會自動返回給發起人。
* 交易費用：手續費由用戶自訂，礦工獲取這些費用作為報酬。
### 10. 挖礦機制與區塊確認
* 交易確認：越早被確認的交易越安全，並能防止雙重支付。
* 交易優先級與失敗風險：支付較高手續費可提升交易優先處理，減少等待和失敗風險。

## 9/23筆記
### bitcoinbook_2nd_zh 第三章學習筆記
如果要開發比特幣，必須先在linux環境創建 BitcoinCore 的開發環境。  
開發環境以後，可以使用 bitcoind --help 尋找到對自己有幫助的指令。 
以下是幾個常見的好用指令： 
- 將bitcoin core 作為後端運行的指令(很重要，許多指令開始之前必須先用到這個指令
  ```bash
  bitcoind -daemon
  ```

- 查閱節點的進程和運行狀態  
```bash
bitcoin-cli getblockchaininfo
```
範例：  
```json
{
  "chain": "main",  
  "blocks": 0,  
  "headers": 83999,  
  "bestblockhash": "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",  
  "difficulty": 1,  
  "mediantime": 1231006505,  
  "verificationprogress": 3.783041623201835e-09,  
  "chainwork": "0000000000000000000000000000000000000000000000000000000100010001",  
  "pruned": false,  
  [...]  
}
```
這展示了區塊鏈高度為0個區塊，有83999個區塊頭的節點。節點先獲取最長鏈的區塊頭，然後繼續下載完整區塊。 
- 檢查區塊
```bash
bitcoin-cli getblockhash (欲查閱的第幾個區塊)
```
這時候，會返回區塊的雜湊值    
- 查閱該區塊的資訊
```
 bitcoin-cli getblock (該區塊的雜湊值)
```
這時候，會返回一個 json 檔，返回該區塊的所有資訊  
示例如下：  
```json
{
  "hash": "00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048",
  "confirmations": 158577,
  "height": 1,
  "version": 1,
  "versionHex": "00000001",
  "merkleroot": "0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098",
  "time": 1231469665,
  "mediantime": 1231469665,
  "nonce": 2573394689,
  "bits": "1d00ffff",
  "difficulty": 1,
  "chainwork": "0000000000000000000000000000000000000000000000000000000200020002",
  "nTx": 1,
  "previousblockhash": "000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
  "nextblockhash": "000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd",
  "strippedsize": 215,
  "size": 215,
  "weight": 860,
  "tx": [
    "0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098"
  ]
}
```
該如何解讀該區塊呢？  
#### 基本信息
- **hash**: `00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048`
  - 這是該區塊的區塊哈希值，區塊哈希是區塊內容的加密摘要，並且是該區塊在區塊鏈中唯一的識別符號。
  
- **confirmations**: `158577`
  - 該區塊在區塊鏈上已被確認了 158,577 次，表示它在區塊鏈的歷史深度，越多確認代表該區塊位置越深、越難被修改。

- **height**: `1`
  - 該區塊的高度是 `1`，這表示它是比特幣區塊鏈的第二個區塊（第一個區塊是創世區塊，區塊高度為 0）。

- **version**: `1`
  - 區塊的版本號，指示該區塊使用的比特幣協議版本。

- **versionHex**: `00000001`
  - 區塊版本的十六進制表示法。

#### Merkle Root
- **merkleroot**: `0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098`
  - 這是區塊中所有交易的 Merkle 樹根哈希，它用來驗證區塊中所有交易的完整性。

#### 時間相關
- **time**: `1231469665`
  - 區塊的時間戳，這是以 Unix 時間格式表示的秒數，對應的時間是 2009-01-09 02:54:25 UTC。

- **mediantime**: `1231469665`
  - 這是該區塊的中位時間戳，代表過去 11 個區塊的中間時間。它有助於防止時間操縱。

#### 其他區塊屬性
- **nonce**: `2573394689`
  - 區塊挖掘過程中的隨機數，礦工透過不斷變動此數字來尋找滿足工作量證明的有效哈希值。

- **bits**: `1d00ffff`
  - 表示難度目標的壓縮表示法，與難度直接相關。

- **difficulty**: `1`
  - 區塊的挖掘難度，這裡顯示的是最早期區塊的最低難度。

- **chainwork**: `0000000000000000000000000000000000000000000000000000000200020002`
  - 這是鏈上總的工作量，表示區塊鏈中所有區塊進行計算的總和。

#### 交易數據
- **nTx**: `1`
  - 區塊中包含的交易數量，這裡顯示為 1 筆交易。

- **tx**: `0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098`
  - 這是該區塊中唯一的交易 ID，這筆交易是創幣交易（coinbase），用於支付給礦工的區塊獎勵。

#### 區塊大小
- **strippedsize**: `215`
  - 區塊移除簽名數據後的大小，以字節為單位。

- **size**: `215`
  - 區塊的總大小，以字節為單位。

- **weight**: `860`
  - 區塊的權重，用於 SegWit（隔離見證）後的區塊大小計算。

#### 區塊鏈連接
- **previousblockhash**: `000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f`
  - 前一個區塊的哈希值，這是比特幣創世區塊的哈希。

- **nextblockhash**: `000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd`
  - 下一個區塊的哈希值，區塊鏈中每個區塊都與前後區塊相連，形成區塊鏈。
### 課堂筆記
#### 區塊鏈與挖礦基本概念
1. **挖礦中的不可篡改性**：
   - 在區塊鏈挖礦過程中，即使對 input 改一點點，output 也會有很大差異，因此不可能作弊。
   - 挖礦時生成的數值只要有一點變化，結果都會不同，這就是挖礦的核心原理之一。

2. **哈希值與解題機制**：
   - 如何保證能在 10 分鐘內完成解題？關鍵在於哈希值必須小於 target。
   - 解題過程中，礦工會在限量的資料內進行大量嘗試，直到達到條件。

3. **挖礦的意義**：
   - 挖礦不僅是為了獲得虛擬貨幣獎勵，還是在幫助區塊鏈進行交易驗證。

#### 區塊鏈中的交易和流動性管理
1. **i 和 j 值的差異**：
   - 挖礦中的 i 和 j 值差異越大越好，因為找更小的值需要額外支付費用給礦工。

2. **交易所與去中心化/中心化**：
   - 區塊鏈技術支援去中心化，許多交易所在此基礎上運作。
   - 大眾普遍建議一次性使用 address，以確保交易的隱私性。

3. **Address 與錢包**：
   - 每個錢包一次會隨機產生 100 個 address，買賣越多，需要的 address 也越多。


4. **流動性**：
   - **流動性 (Liquidity)** 是指資產變現的能力，換錢時通常需要支付手續費。
   - 一個關鍵問題是能否減少手續費，降低金錢與時間成本。此處提出了 **流動性節省機制 (Liquidity Saving Mechanism)** 的概念。

5. **流動性管理挑戰**：
   - 流動性管理目前沒有最佳解，尤其是在區塊鏈中，越多的交易和資產流動，資產的價值越高。
   - 所有在區塊鏈中的錢都像是支票，公開所有的轉帳交易有助於流動性管理。

6. **交易規則**：
   - 每筆交易的 input 必須大於 output，交易才能被區塊鏈網路接受。

#### 區塊鏈的問題與挑戰
1. **流動性問題**：
   - 區塊鏈需要解決如何有效管理資產流動性，特別是在跨國交易中避免高手續費和時間成本。

2. **跨國轉帳與洗錢問題**：
   - 雖然區塊鏈技術具有即時性和透明性，但也被一些不法分子利用進行跨國洗錢。

3. **區塊鏈議題**：
   - 一個值得思考的問題是如何設計一個公平的機制來決定誰擁有區塊的權利，也就是誰是這場競賽的贏家。

#### 區塊鏈技術重點
1. **區塊鏈的意義**：
   - 自網際網路時代以來，區塊鏈是現今最重要的技術之一。
   - 它使用 **分散式帳本技術 (Distributed Ledger Technology, DLT)**，也被稱為 **信任機器 (Trust Machine)**。
   - 區塊鏈系統本質上是一種交易作業系統 (Transacton Operating System)，具有信任、分散式和即時性三大特點。

2. **UTXO (Unspent Transaction Output)**：
   - **UTXO** 是指還沒有花費出去的交易輸出，這些交易輸出可作為未來交易的 input。
   - 雖然理論上可能會有許多未被認證的交易，但目前的區塊鏈系統應該不會發生這樣的問題。

3. **比特幣的資料庫使用**：
   - 比特幣採用 **label-DB** 來處理交易記錄。


#### 比特幣與區塊鏈技術

1. **比特幣與區塊鏈的關係**：
   - **比特幣 (Bitcoin)** 是建立在 **區塊鏈 (Blockchain)** 技術之上的一種去中心化加密貨幣，利用區塊鏈來處理各種交易和記錄數據。

2. **價值轉移 (Value Transfer)**：
   - 區塊鏈使得比特幣可以安全地在互聯網上進行價值轉移，實現無需中介的資金流動。每一筆交易都會被驗證並永久記錄在區塊鏈上，確保交易的透明與不可篡改性。

3. **點對點交易 (P2P)**：
   - 比特幣利用區塊鏈進行點對點 (Peer-to-Peer, P2P) 的交易，消除了對傳統金融機構的依賴，允許用戶之間直接交易而無需經過第三方。

4. **複製與容錯機制 (Replica & Fault Tolerance)**：
   - 區塊鏈的分佈式網絡結構使得交易資料被複製到多個節點，這樣即使部分節點失效或遭受攻擊，整個系統仍能保持運行並保護資料不被篡改。

5. **共識機制 (Reach Consensus)**：
   - 在區塊鏈中，參與的節點必須通過共識機制來達成對每一筆交易的共識。這種機制確保了所有節點對交易歷史有相同的理解，保證數據的一致性和完整性。

6. **計算轉移 (Computation Transfer)**：
   - 區塊鏈支持將部分計算工作分散到不同的節點上來處理，這樣能夠減輕單一節點的負擔，並提高系統的效率和安全性。




-----   
### 上課筆記：
## 9/30筆記
